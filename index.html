<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='utf-8' />
  <meta name='viewport' content='width=device-width, initial-scale=1.0' />
  <title>Escape the Engineering Building â€” Vertical DescentBoz</title>
  <style>
    :root{--bg:#0d1117;--panel:#161b22;--text:#e6edf3;--muted:#9da7b1;--accent:#3b82f6;--ok:#10b981;--error:#ef4444}
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans';background:linear-gradient(120deg,#0d1117,#0b1220 40%,#0d1117);color:var(--text)}
    .wrap{max-width:900px;margin:0 auto;padding:2rem 1rem 4rem}
    header{display:flex;align-items:center;gap:1rem;margin-bottom:1rem}
    header h1{font-size:clamp(1.6rem,2.8vw,2.4rem);margin:0}
    .card{background:var(--panel);border:1px solid #222a36;border-radius:16px;padding:1.25rem;box-shadow:0 6px 24px rgba(0,0,0,.25)}
    .story{color:var(--muted);line-height:1.55}
    .room{display:none;margin-top:1rem}
    .room.active{display:block;animation:fade .35s ease-in}
    @keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
    .q{font-size:1.05rem;line-height:1.5;white-space:pre-line}
    .controls{display:flex;flex-wrap:wrap;gap:.75rem;align-items:center;margin-top:1rem}
    input[type=text]{background:#0b1220;color:var(--text);border:1px solid #243043;border-radius:12px;padding:.85rem 1rem;width:min(520px,100%);outline:none}
    button{cursor:pointer;background:var(--accent);color:#fff;border:none;border-radius:12px;padding:.8rem 1.1rem;font-weight:600}
    button[disabled]{opacity:.5;cursor:not-allowed}
    .hint,.feedback{margin-top:.5rem;font-size:.95rem;color:var(--muted)}
    .feedback.ok{color:var(--ok)}.feedback.err{color:var(--error)}
    .level-pill{display:inline-flex;align-items:center;gap:.5rem;background:#0b1322;border:1px solid #223047;border-radius:99px;padding:.4rem .7rem;font-size:.9rem;color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr;gap:1rem}.next{background:var(--ok)}
    footer{margin-top:2rem;color:var(--muted);font-size:.9rem}
    .confetti{position:fixed;inset:0;pointer-events:none}
  </style>
</head>
<body>
  <canvas class='confetti'></canvas>
  <div class='wrap'>
    <header>
      <h1>Escape the Engineering Building â€” Vertical Descent</h1>
      <span class='level-pill'><strong>6</strong> Levels</span>
    </header>

    <div class='card story'>
      Aaaaa power surge has locked access points across the engineering building. Your only way out: descend floor by floor, solving location-based clues in real labs â€” from the VR suite on the top floor down to the CNC workshop underground. Each correct entry unlocks the next level.
    </div>

    <div id='rooms' class='grid'></div>

    <footer>
      Answers are usually a <em>room number</em>, a <em>label</em>, or a <em>keyword</em> youâ€™ll find in that space. (Case-insensitive.)
    </footer>
  </div>

  <script>
  (function(){
    // Compatibility helpers
    function toStr(x){ return String(x==null?'':x); }
    function nl2br(s){ return toStr(s).split('\n').join('<br>'); }
    function clean(s){ var t=toStr(s).trim().toLowerCase(); t=t.split(' ').join(''); t=t.split('-').join(''); t=t.split('_').join(''); return t; }
    function onlyDigits(s){ var txt=toStr(s); var out=''; for(var i=0;i<txt.length;i++){ var c=txt[i]; if(c>='0'&&c<='9') out+=c; } return out.length?Number(out):NaN; }

    // --- Simple Base64 helpers (atob may exist in browsers; provide fallback)
    function b64decode(s){ try{ if(typeof atob==='function') return atob(s); }catch(e){} // fall through
      // fallback - simple polyfill for base64 (handles standard base64)
      var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
      var str = String(s).replace(/=+$/,'');
      var output = '';
      for(var bc=0, bs, buffer, idx=0; buffer = str.charAt(idx++); ~buffer && (bs = bc %4 ? bs*64 + buffer : buffer, bc++ %4) ? output += String.fromCharCode(255 & bs >> (-2*bc & 6)) : 0){ buffer = chars.indexOf(buffer); }
      return output;
    }

    // Encoded accepted answers per level (Base64). If someone views source they'll see gibberish.
    var ANSWERS = [
      // Level 1 - VR suite (accepts vr204, vrsuite, virtualreality, vr)
      ['dnIwMjQ=','dnJzdWl0ZQ==','dmlydHVhbHJlYWxpdHk=','dnI='],
      // Level 2 - Fire lab
      ['ZmlyZWxhYjAy','ZmlyZWxhYg==','ZmxhbW1hYmlsaXR5'],
      // Level 3 - 3D printing
      ['bWszcw==','cHJ1c2E=','M2RwcmludGluZw==','M2RwcmludGluZ3Jvb20='],
      // Level 4 - Motorsport & composites
      ['bW90b3JzcGFydA==','dmVsb2NpdHk=','Y29tcG9zaXRlcw==','bW90b3JzcG9ydGxhYg=='],
      // Level 5 - Simulation lab
      ['c2ltdWxhdGlvbg==','c2ltbGFi','ZmxpZ2h0c2lt','bGcwMQ=='],
      // Level 6 - CNC final (we'll check digits)
      ['NQ==']
    ];

    // Decode answers once at startup
    var DECODED = ANSWERS.map(function(list){ return list.map(function(e){ return b64decode(e).toLowerCase(); }); });

    // Level definitions
    var ROOMS = [
      { title:'Level 1 - VR Suite (Top Floor)', prompt:'"Reality bends upstairs - seek the world that is not real, to reveal what is true."\n\nFind the VR Suite on the top floor. Enter the room number or keyword you see there (for example, VR204 or VR Suite).', check:function(ans){ var a=clean(ans); return DECODED[0].indexOf(a)!==-1; }, hint:'Try the room code on the door.' },
      { title:'Level 2 - Fire Laboratory', prompt:'Descend one floor. "Where heat meets safety, flames are studied, not feared."\n\nEnter the room number or a label you find in the Fire Lab.', check:function(ans){ var a=clean(ans); return DECODED[1].indexOf(a)!==-1; }, hint:'Look for controlled-combustion equipment.' },
      { title:'Level 3 - 3D Printing Workshop', prompt:'Descend again. "Where ideas become matter, one layer at a time."\n\nEnter a printer model code or the room label you find (for example, MK3S, Prusa).', check:function(ans){ var a=clean(ans); return DECODED[2].indexOf(a)!==-1; }, hint:'Check the machine tag.' },
      { title:'Level 4 - Motorsport & Composites Lab', prompt:'Go down two floors (skip one). "Engines sleep and carbon weaves dream of speed."\n\nEnter the team name, a room label, or a code you find near the car.', check:function(ans){ var a=clean(ans); return DECODED[3].indexOf(a)!==-1; }, hint:'Look near the steering wheel or composite layup.' },
      { title:'Level 5 - Simulation Lab (Lower Ground)', prompt:'Descend to the lower ground. "What flies safely is rehearsed here first."\n\nEnter the room number or a keyword you find there (for example, Simulation, Sim Lab).', check:function(ans){ var a=clean(ans); return DECODED[4].indexOf(a)!==-1; }, hint:'Check the door plaque or console.' },
      { title:'Level 6 - CNC Workshop Finale', prompt:'Final step! "Creation obeys a number."\n\nFrom previous clues, you have determined the CNC program number (for example, based on a 5-axis hint -> program 5). Enter that number now.', check:function(ans){ var n=onlyDigits(ans); return n===5; }, hint:'Think: axis count -> program number.' }
    ];

    // UI builder
    var roomsEl = document.getElementById('rooms');
    function makeRoom(i, room){
      var div=document.createElement('div'); div.className='card room'+(i===0?' active':''); div.dataset.index=i;
      div.innerHTML=''+
        '<h2 style="margin:0 0 .5rem 0">'+room.title+'</h2>'+
        '<div class="q">'+nl2br(room.prompt)+'</div>'+
        '<div class="controls">'+
          '<input type="text" placeholder="Type your answer..." aria-label="answer input">'+
          '<button class="submit">Submit</button>'+
          '<button class="next" disabled>Next Room -></button>'+
        '</div>'+
        '<div class="feedback" aria-live="polite"></div>'+
        '<div class="hint">Hint: '+(room.hint||'')+'</div>';
      var input=div.querySelector('input'), submit=div.querySelector('.submit'), next=div.querySelector('.next'), fb=div.querySelector('.feedback');
      submit.addEventListener('click',function(){ var v=input.value; if(room.check(v)){ fb.textContent='âœ“ Correct!'; fb.className='feedback ok'; next.disabled=false; next.focus(); }else{ fb.textContent='âœ— Not yet - try again!'; fb.className='feedback err'; } });
      next.addEventListener('click',function(){ var idx=parseInt(div.dataset.index,10); div.classList.remove('active'); if(idx+1<ROOMS.length){ var nxt=document.querySelector('.room[data-index="'+(idx+1)+'"]'); nxt.classList.add('active'); var f=nxt.querySelector('input'); if(f) f.focus(); }else{ celebrate(); } });
      return div;
    }

    function build(){ ROOMS.forEach(function(r,i){ roomsEl.appendChild(makeRoom(i,r)); }); }

    function celebrate(){ var canvas=document.querySelector('.confetti'); var ctx=canvas.getContext('2d'); function resize(){ canvas.width=innerWidth; canvas.height=innerHeight; } resize(); addEventListener('resize',resize); var parts=[]; for(var i=0;i<200;i++){ parts.push({x:Math.random()*canvas.width,y:-10-Math.random()*canvas.height,r:2+Math.random()*4,vy:2+Math.random()*3,vx:(Math.random()-0.5)*1.5}); }
      var msg=document.createElement('div'); msg.className='card'; msg.style.position='fixed'; msg.style.left='50%'; msg.style.top='10%'; msg.style.transform='translateX(-50%)'; msg.style.zIndex='10'; msg.innerHTML='<h2>ðŸŽ‰ You escaped!</h2><p>Proceed to the CNC workshop and run your program.</p>'; document.body.appendChild(msg);
      var t=0; (function loop(){ ctx.clearRect(0,0,canvas.width,canvas.height); parts.forEach(function(p){ p.x+=p.vx; p.y+=p.vy; p.vy+=0.02; if(p.y>canvas.height+10){ p.y=-10; p.x=Math.random()*canvas.width; p.vy=2+Math.random()*3; } ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); }); if(t++<1000) requestAnimationFrame(loop); })(); }

    // Tests
    function runTests(){ var fails=0; function eq(a,b,name){ if(a!==b){ console.error('FAIL',name,{a,b}); fails++; }else{ console.log('PASS',name); } } function ok(cond,name){ if(!cond){ console.error('FAIL',name); fails++; }else{ console.log('PASS',name); } }
      eq(nl2br('a\nb'),'a<br>b','nl2br');
      eq(clean('VR 204'),'vr204','clean-space');
      eq(clean('VR-204'),'vr204','clean-dash');
      eq(clean('VR_204'),'vr204','clean-underscore');
      eq(onlyDigits('abc5-12'),512,'onlyDigits');
      ok(DECODED[0].indexOf(clean('VR-204'))!==-1,'level1 vr-204');
      ok(DECODED[4].indexOf(clean('simulation'))!==-1,'level5 simulation');
      ok(ROOMS[5].check('Program 5'),'final accepts program 5');
      var firstNext=document.querySelector('.room[data-index="0"] .next'); ok(firstNext && firstNext.disabled===true,'initial next disabled');
      if(fails===0) console.log('All tests passed.'); else console.warn(fails+' tests failed'); }

    build(); try{ runTests(); }catch(e){ console.warn('Tests error',e); }
  })();
  </script>
</body>
</html>
